
{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
  <h2>Resumen por Socio — {{ ym }}</h2>

  <form class="row g-2 mb-3" method="get">
    <div class="col-auto">
      <label class="form-label">Mes (YM)</label>
      <select class="form-select" name="ym">
        {% for y in ym_list %}
          <option value="{{ y }}" {% if y==ym %}selected{% endif %}>{{ y }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto align-self-end">
      <button class="btn btn-outline-primary" type="submit">Aplicar</button>
    </div>
    <div class="col-auto align-self-end">
      <a class="btn btn-outline-success" href="{{ url_for('resumen_socio_export', ym=ym, format='xlsx') }}">Exportar XLSX</a>
    </div>
    <div class="col-auto align-self-end">
      <a class="btn btn-outline-secondary" href="{{ url_for('resumen_socio_export', ym=ym, format='csv') }}">Exportar CSV</a>
    </div>
  </form>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for cat, msg in messages %}
        <div class="alert alert-{{ 'warning' if cat=='warning' else cat }}" role="alert">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="table-responsive">
    <table class="table table-sm table-striped align-middle">
      <thead>
        
    <tr>
      <th style="text-align: left;">Socio</th>
      <th style="text-align: right;">Ganancia Neta</th>
      <th style="text-align: right;">Margen Empresa</th>
      <th style="text-align: right;">Margen Vendedor</th>
      <th style="text-align: right;">Margen Socios</th>
      <th style="text-align: right;">Margen Otros Socios</th>
      <th style="text-align: right;">Total Márgenes</th>
    </tr>

      </thead>
      <tbody>
        {% for r in filas %}
        <tr>
          <td>{{ r.nombre_socio }}</td>
          <td class="text-end">{{ r.Ganancia_neta | ars }}</td>
          <td class="text-end">{{ r.Margen_Empresa | ars }}</td>
          <td class="text-end">{{ r.Margen_Vendedor | ars }}</td>
          <td class="text-end">{{ r.Margen_Socios | ars }}</td>
          <td class="text-end">{{ r.Margen_Otros_Socios | ars }}</td>
          <td class="text-end">{{ r.Total_Margenes | ars }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
